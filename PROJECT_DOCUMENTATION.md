# Kare - Detailed Project Documentation

This document provides a comprehensive technical overview of the Kare application, intended for developers. It covers the project's architecture, data flow, file structure, and core components in detail.

## 1. High-Level Architecture

Kare follows a **feature-oriented, service-based architecture**. The goal is to separate concerns, making the codebase modular, scalable, and easy to maintain.

-   **UI Layer (`screens/` & `widgets/`)**: Composed of Flutter widgets responsible for rendering the UI and capturing user input. This layer is kept as "dumb" as possible, meaning it contains minimal business logic.
-   **Service Layer (`services/`)**: The core of the application. This layer contains all the business logic, data manipulation, and communication with the database. UI widgets call methods on these services to perform actions and retrieve state.
-   **Data Layer (`models/`)**: Defines the application's data structures using Hive objects. These are simple, plain Dart objects that are serialized and stored locally.

This architecture uses a **singleton service locator pattern** for accessing services and `ChangeNotifier` to notify the UI of state changes.

## 2. File & Folder Structure (`lib/`)

```
kare/
├── lib/
│   ├── models/                   # Data models (Hive objects)
│   │   ├── intake_log.dart
│   │   ├── intake_log.g.dart
│   │   ├── medication.dart
│   │   ├── medication.g.dart
│   │   ├── profile.dart
│   │   └── profile.g.dart
│   │
│   ├── screens/                  # Main UI screens
│   │   ├── add_medication_screen.dart
│   │   ├── dashboard_screen.dart
│   │   ├── edit_medication_screen.dart
│   │   ├── history_screen.dart
│   │   ├── home_screen.dart
│   │   ├── medication_history_screen.dart
│   │   ├── pin_screen.dart
│   │   ├── settings_screen.dart
│   │   └── setup_screen.dart
│   │
│   ├── services/                 # Business logic and data handling
│   │   ├── auth_service.dart
│   │   ├── local_storage_service.dart
│   │   ├── log_service.dart
│   │   ├── notification_service.dart
│   │   ├── profile_service.dart
│   │   └── stats_service.dart
│   │
│   ├── widgets/                  # Reusable UI components
│   │   └── medication_cards.dart
│   │
│   └── main.dart                 # App entry point, theme setup, and service initialization
```

### `main.dart`

-   **Purpose**: The entry point of the application.
-   **Core Logic**:
    -   Initializes all necessary services (`LocalStorageService`, `LogService`, `ProfileService`, `NotificationService`).
    -   Sets up the global `ThemeData` for both light and dark modes.
    -   Determines the initial screen to display (`SetupScreen` for first-time users, `PinScreen` if a PIN is set, or `HomeScreen`).

### `models/`

This directory contains the data models for the application, which are all `HiveObject`s for local persistence.

-   **`medication.dart`**: Defines the `Medication` object with fields for name, dosage, schedule, urgency, etc.
-   **`intake_log.dart`**: Defines the `IntakeLog` object, which represents a single instance of a medication being taken. It includes the status (`taken_on_time`, `taken_late`), timestamp, and optional notes.
-   **`profile.dart`**: Defines the `Profile` object, which stores the user's name, PIN, and total points.
-   **`*.g.dart` files**: These are auto-generated by `hive_generator` and should not be manually edited. They contain the `TypeAdapter`s for reading/writing the models to the database.

### `services/`

This directory contains the core business logic of the application.

-   **`local_storage_service.dart`**: A wrapper around Hive that provides a clean API for all database operations (CRUD for medications, profiles, etc.). It abstracts the Hive implementation details from the rest of the app.
-   **`profile_service.dart`**: Manages user profiles, including creating, deleting, and switching between profiles. It also handles the logic for adding points to the current user's profile.
-   **`log_service.dart`**: Manages all `IntakeLog` entries. Its `addLog` method contains the business logic for awarding points based on the intake status.
-   **`notification_service.dart`**: Handles all aspects of local notifications. It schedules, cancels, and customizes notifications based on urgency.
-   **`stats_service.dart`**: The analytics engine of the app. It calculates all the statistics displayed on the dashboard, such as daily/weekly/monthly progress, the daily streak, and the adherence heatmap.
-   **`auth_service.dart`**: Manages the app's lock state. It provides a simple `unlockApp` method and a `isLocked` flag.

### `screens/`

This directory contains the main UI screens of the application.

-   **`home_screen.dart`**: The main screen after login. It contains the `BottomNavigationBar` and manages the currently displayed tab (`Dashboard`, `Medications`, `History`, `Settings`).
-   **`dashboard_screen.dart`**: The primary landing screen. It displays a variety of widgets that provide an overview of the user's medication adherence and progress.
-   **`add_medication_screen.dart` & `edit_medication_screen.dart`**: These screens contain the forms for adding and editing medications. They include UI elements for setting the medication's name, dosage, schedule, urgency, etc.
-   **`history_screen.dart`**: Displays a detailed history of all medication intakes, grouped by day.
-   **`settings_screen.dart`**: Provides access to app-wide settings, such as theme selection, profile management, and data management.
-   **`pin_screen.dart`**: The screen for setting and verifying the user's 4-digit PIN.
-   **`setup_screen.dart`**: The onboarding flow for new users. It uses a `PageView` to guide users through the app's main features before prompting them to create a profile and set a PIN.

### `widgets/`

This directory contains reusable UI components.

-   **`medication_cards.dart`**: Defines the `ActiveMedicationCard` and `InactiveMedicationCard` widgets. The `ActiveMedicationCard` is a key component that displays an active medication, its schedule, and its urgency level. It also handles the logic for logging intakes and displaying the `IntakeLog` details.

## 5. Code Generation

This project uses `build_runner` and `hive_generator` to automatically generate the `TypeAdapter` code for the Hive models. Whenever you add or modify a field in a model file (e.g., `medication.dart`), you **must** run the following command to regenerate the corresponding `.g.dart` file:

```sh
dart run build_runner build --delete-conflicting-outputs
```
